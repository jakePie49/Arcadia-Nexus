<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arcadia Nexus v10.5 (Stable)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { 
            overscroll-behavior-y: none; 
            background-color: #020617;
            font-family: ui-sans-serif, system-ui, sans-serif;
            color: #f1f5f9;
        }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        
        .main-container { width: 100%; display: flex; flex-direction: column; gap: 1.5rem; }
        @media (min-width: 1024px) {
            .main-container { display: grid; grid-template-columns: 420px 1fr; align-items: start; gap: 2rem; }
        }

        .tab-active { color: #22d3ee; border-bottom: 2px solid #22d3ee; }
        @keyframes pulse-cyan { 0%, 100% { opacity: 1; filter: drop-shadow(0 0 4px #22d3ee); } 50% { opacity: 0.4; } }
        .sync-active { animation: pulse-cyan 1.5s infinite; }
        
        @keyframes aurora { 
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .ai-glow { 
            background: linear-gradient(-45deg, #083344, #1e1b4b, #312e81, #164e63);
            background-size: 400% 400%;
            animation: aurora 15s ease infinite;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden flex justify-center items-center lg:p-6">
    <div id="root" class="h-full w-full flex justify-center items-center max-w-[1440px]"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const modelName = "gemini-2.5-flash-preview-09-2025";

        const callGemini = async (prompt, systemInstruction, key) => {
            if (!key) return "Oracle Offline: Key Missing in System Tab.";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "The Oracle is silent.";
            } catch (error) {
                return "Connection to the Arcadia Mind lost.";
            }
        };

        const LOGIC = {
            getMod: (s) => Math.floor((s - 10) / 2),
            getLevel: (xp) => {
                const table = [0, 300, 900, 2700, 6500, 14000, 23000, 34000, 48000, 64000, 85000, 100000, 120000, 140000, 165000, 195000, 225000, 265000, 305000, 355000];
                for (let i = table.length - 1; i >= 0; i--) if (xp >= table[i]) return i + 1;
                return 1;
            },
            getPB: (xp) => Math.ceil(LOGIC.getLevel(xp) / 4) + 1
        };

        const Icons = {
            Sword: (p) => <svg {...p} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M14.5 17.5 3 6 3 3 6 3 17.5 14.5m-4.5 4.5 6-6m-3 3 4 4"/></svg>,
            Oracle: (p) => <svg {...p} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10H12V2z"/><path d="M12 12L2.69 7.03"/><path d="M12 12l5.56 8.52"/><circle cx="12" cy="12" r="3"/></svg>,
            Sparkle: (p) => <svg {...p} fill="currentColor" viewBox="0 0 24 24"><path d="M9 1l2 6 6 2-6 2-2 6-2-6-6-2 6-2 2-6z"/></svg>,
            Save: (p) => <svg {...p} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><path d="M17 21v-8H7v8"/></svg>,
            Shield: (p) => <svg {...p} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Discord: (p) => <svg {...p} fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.23 10.23 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 1-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>,
            Skull: (p) => <svg {...p} fill="none" stroke="currentColor" strokeWidth="2.5" viewBox="0 0 24 24"><path d="M9 10h.01M15 10h.01M12 2a8 8 0 0 0-8 8v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2a8 8 0 0 0-8-8zM8 22h8v-2a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2z"/></svg>
        };

        const defaultCharacter = {
            meta: { name: "Randy 'Brawler' Marsh", race: "Human", class: "Fighter", xp: 0 },
            stats: { str: 1
